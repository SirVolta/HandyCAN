<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HandyCANInterlinkNode: src/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HandyCANInterlinkNode
   &#160;<span id="projectnumber">0.1Beta</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>HandyCAN interlink node.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;diag/Trace.h&quot;</code><br />
<code>#include &quot;<a class="el" href="stm32f10x__conf_8h_source.html">stm32f10x_conf.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.c:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c__incl.png" border="0" usemap="#src_2main_8c" alt=""/></div>
<map name="src_2main_8c" id="src_2main_8c">
<area shape="rect" id="node3" href="stm32f10x__conf_8h.html" title="STM32 configuration file. " alt="" coords="475,80,614,107"/>
</map>
</div>
</div>
<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCANMessageToSend.html">CANMessageToSend</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">incoming CAN message to send over the UART  <a href="structCANMessageToSend.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5aa8993e015a681ccd0c9bef1b243a49"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a5aa8993e015a681ccd0c9bef1b243a49">GPIO_ToggleBits</a>(GPIOx,  GPIO_Pin)&#160;&#160;&#160;GPIO_WriteBit(GPIOx, GPIO_Pin, !GPIO_ReadOutputDataBit(GPIOx, GPIO_Pin));</td></tr>
<tr class="memdesc:a5aa8993e015a681ccd0c9bef1b243a49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toggles a IO pin.  <a href="#a5aa8993e015a681ccd0c9bef1b243a49">More...</a><br /></td></tr>
<tr class="separator:a5aa8993e015a681ccd0c9bef1b243a49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95850a46bbeede4b70eb6e556f33a1c9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a>&#160;&#160;&#160;0xF0</td></tr>
<tr class="memdesc:a95850a46bbeede4b70eb6e556f33a1c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates start of the UART protocol.  <a href="#a95850a46bbeede4b70eb6e556f33a1c9">More...</a><br /></td></tr>
<tr class="separator:a95850a46bbeede4b70eb6e556f33a1c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb8167f4f0890c2ff3178db02172c6dc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a>&#160;&#160;&#160;0xFA</td></tr>
<tr class="memdesc:adb8167f4f0890c2ff3178db02172c6dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Must come right after <a class="el" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9" title="Indicates start of the UART protocol. ">STARTSYNCBYTE1</a> to indicate start.  <a href="#adb8167f4f0890c2ff3178db02172c6dc">More...</a><br /></td></tr>
<tr class="separator:adb8167f4f0890c2ff3178db02172c6dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae850c489f0e65c48f92e854b5047a0b4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a>&#160;&#160;&#160;0xE0</td></tr>
<tr class="memdesc:ae850c489f0e65c48f92e854b5047a0b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates end of the UART protocol.  <a href="#ae850c489f0e65c48f92e854b5047a0b4">More...</a><br /></td></tr>
<tr class="separator:ae850c489f0e65c48f92e854b5047a0b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfb421c17a571eaf007319362b5f3150"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a>&#160;&#160;&#160;0xEF</td></tr>
<tr class="separator:adfb421c17a571eaf007319362b5f3150"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af522364e8a3d83be725532c9550ef632"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#af522364e8a3d83be725532c9550ef632">LENIDX</a>&#160;&#160;&#160;2</td></tr>
<tr class="memdesc:af522364e8a3d83be725532c9550ef632"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of length in a UART message.  <a href="#af522364e8a3d83be725532c9550ef632">More...</a><br /></td></tr>
<tr class="separator:af522364e8a3d83be725532c9550ef632"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d8c7653fe8bc2515492b3d5508043ed"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a>&#160;&#160;&#160;3</td></tr>
<tr class="memdesc:a2d8c7653fe8bc2515492b3d5508043ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of amount of check bytes in UART message.  <a href="#a2d8c7653fe8bc2515492b3d5508043ed">More...</a><br /></td></tr>
<tr class="separator:a2d8c7653fe8bc2515492b3d5508043ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b9b3385907586a36086aca0194dc425"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a2b9b3385907586a36086aca0194dc425">STDIDLIDX</a>&#160;&#160;&#160;4</td></tr>
<tr class="memdesc:a2b9b3385907586a36086aca0194dc425"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of stdid low byte in UART message.  <a href="#a2b9b3385907586a36086aca0194dc425">More...</a><br /></td></tr>
<tr class="separator:a2b9b3385907586a36086aca0194dc425"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b77446b9fff7ef417fd41d94261a7b0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a0b77446b9fff7ef417fd41d94261a7b0">STDIDHIDX</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:a0b77446b9fff7ef417fd41d94261a7b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of stdid high byte in UART message.  <a href="#a0b77446b9fff7ef417fd41d94261a7b0">More...</a><br /></td></tr>
<tr class="separator:a0b77446b9fff7ef417fd41d94261a7b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5b70d1610bc80caa8de5d76d4036771"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ab5b70d1610bc80caa8de5d76d4036771">DATAIDX</a>&#160;&#160;&#160;6</td></tr>
<tr class="memdesc:ab5b70d1610bc80caa8de5d76d4036771"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of start of the data bytes in uart message.  <a href="#ab5b70d1610bc80caa8de5d76d4036771">More...</a><br /></td></tr>
<tr class="separator:ab5b70d1610bc80caa8de5d76d4036771"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af57bde854fa2b396f29664995a502b19"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#af57bde854fa2b396f29664995a502b19">USB_LP_CAN1_RX0_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:af57bde854fa2b396f29664995a502b19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when there is a package on the CAN bus.  <a href="#af57bde854fa2b396f29664995a502b19">More...</a><br /></td></tr>
<tr class="separator:af57bde854fa2b396f29664995a502b19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae087c57bb8f29d173b8b97a9b3c66bfa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae087c57bb8f29d173b8b97a9b3c66bfa">sendCANMessage</a> (void)</td></tr>
<tr class="memdesc:ae087c57bb8f29d173b8b97a9b3c66bfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a CAN message over UART to the PC.  <a href="#ae087c57bb8f29d173b8b97a9b3c66bfa">More...</a><br /></td></tr>
<tr class="separator:ae087c57bb8f29d173b8b97a9b3c66bfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7139cd4baabbbcbab0c1fe6d7d4ae1cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a7139cd4baabbbcbab0c1fe6d7d4ae1cc">USART1_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a7139cd4baabbbcbab0c1fe6d7d4ae1cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recieves and stores bytes from PC. When all are present, sends them as a CAN message.  <a href="#a7139cd4baabbbcbab0c1fe6d7d4ae1cc">More...</a><br /></td></tr>
<tr class="separator:a7139cd4baabbbcbab0c1fe6d7d4ae1cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f7efc03bd3aca3d9724efe31e5a1630"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a6f7efc03bd3aca3d9724efe31e5a1630">CAN_init</a> (void)</td></tr>
<tr class="memdesc:a6f7efc03bd3aca3d9724efe31e5a1630"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the CAN peripheral and recieve interupt.  <a href="#a6f7efc03bd3aca3d9724efe31e5a1630">More...</a><br /></td></tr>
<tr class="separator:a6f7efc03bd3aca3d9724efe31e5a1630"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68189a0494c0d7faf3415e8ce73d573a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a68189a0494c0d7faf3415e8ce73d573a">UART_init</a> (void)</td></tr>
<tr class="memdesc:a68189a0494c0d7faf3415e8ce73d573a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the UART peripheral and recieve interupt.  <a href="#a68189a0494c0d7faf3415e8ce73d573a">More...</a><br /></td></tr>
<tr class="separator:a68189a0494c0d7faf3415e8ce73d573a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a049fa4a9b6c1b44b0eef7619b91840d0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a049fa4a9b6c1b44b0eef7619b91840d0">GPIO_init</a> (void)</td></tr>
<tr class="memdesc:a049fa4a9b6c1b44b0eef7619b91840d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the GPIO pins.  <a href="#a049fa4a9b6c1b44b0eef7619b91840d0">More...</a><br /></td></tr>
<tr class="separator:a049fa4a9b6c1b44b0eef7619b91840d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a372851451d2a0908f6ab3a497d3593ec"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a372851451d2a0908f6ab3a497d3593ec">overruns</a> = 0</td></tr>
<tr class="memdesc:a372851451d2a0908f6ab3a497d3593ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">for debug  <a href="#a372851451d2a0908f6ab3a497d3593ec">More...</a><br /></td></tr>
<tr class="separator:a372851451d2a0908f6ab3a497d3593ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a010129fb538a38e59899ecc8241a2bf9"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structCANMessageToSend.html">CANMessageToSend</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a></td></tr>
<tr class="separator:a010129fb538a38e59899ecc8241a2bf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>HandyCAN interlink node. </p>
<dl class="section author"><dt>Author</dt><dd>SirVolta </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Sep 18, 2017 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Connects the CAN bus to the PC </dd></dl>

<p class="definition">Definition in file <a class="el" href="main_8c_source.html">main.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a2d8c7653fe8bc2515492b3d5508043ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d8c7653fe8bc2515492b3d5508043ed">&#9670;&nbsp;</a></span>CHECKLENIDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECKLENIDX&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Index of amount of check bytes in UART message. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00096">96</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="ab5b70d1610bc80caa8de5d76d4036771"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5b70d1610bc80caa8de5d76d4036771">&#9670;&nbsp;</a></span>DATAIDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DATAIDX&#160;&#160;&#160;6</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Index of start of the data bytes in uart message. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00102">102</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="ae850c489f0e65c48f92e854b5047a0b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae850c489f0e65c48f92e854b5047a0b4">&#9670;&nbsp;</a></span>ENDSYNCBYTE1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ENDSYNCBYTE1&#160;&#160;&#160;0xE0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates end of the UART protocol. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00089">89</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="adfb421c17a571eaf007319362b5f3150"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfb421c17a571eaf007319362b5f3150">&#9670;&nbsp;</a></span>ENDSYNCBYTE2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ENDSYNCBYTE2&#160;&#160;&#160;0xEF</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Must come right after <a class="el" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9" title="Indicates start of the UART protocol. ">STARTSYNCBYTE1</a> to indicate end TODO: Change this to 0xEE, as 0xEF+1 = 0xF0, which is start1! DO'H! </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00092">92</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="a5aa8993e015a681ccd0c9bef1b243a49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5aa8993e015a681ccd0c9bef1b243a49">&#9670;&nbsp;</a></span>GPIO_ToggleBits</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GPIO_ToggleBits</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">GPIOx, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">GPIO_Pin&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;GPIO_WriteBit(GPIOx, GPIO_Pin, !GPIO_ReadOutputDataBit(GPIOx, GPIO_Pin));</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Toggles a IO pin. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00082">82</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00122">USB_LP_CAN1_RX0_IRQHandler()</a>.</p>

</div>
</div>
<a id="af522364e8a3d83be725532c9550ef632"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af522364e8a3d83be725532c9550ef632">&#9670;&nbsp;</a></span>LENIDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LENIDX&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Index of length in a UART message. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00094">94</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="a95850a46bbeede4b70eb6e556f33a1c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95850a46bbeede4b70eb6e556f33a1c9">&#9670;&nbsp;</a></span>STARTSYNCBYTE1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STARTSYNCBYTE1&#160;&#160;&#160;0xF0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates start of the UART protocol. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00085">85</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="adb8167f4f0890c2ff3178db02172c6dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb8167f4f0890c2ff3178db02172c6dc">&#9670;&nbsp;</a></span>STARTSYNCBYTE2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STARTSYNCBYTE2&#160;&#160;&#160;0xFA</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Must come right after <a class="el" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9" title="Indicates start of the UART protocol. ">STARTSYNCBYTE1</a> to indicate start. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00087">87</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="a0b77446b9fff7ef417fd41d94261a7b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b77446b9fff7ef417fd41d94261a7b0">&#9670;&nbsp;</a></span>STDIDHIDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STDIDHIDX&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Index of stdid high byte in UART message. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00100">100</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<a id="a2b9b3385907586a36086aca0194dc425"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b9b3385907586a36086aca0194dc425">&#9670;&nbsp;</a></span>STDIDLIDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STDIDLIDX&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Index of stdid low byte in UART message. </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00098">98</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00222">USART1_IRQHandler()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6f7efc03bd3aca3d9724efe31e5a1630"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f7efc03bd3aca3d9724efe31e5a1630">&#9670;&nbsp;</a></span>CAN_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void CAN_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes the CAN peripheral and recieve interupt. </p>
<dl class="section note"><dt>Note</dt><dd>The filter recieves EVERY CAN message into FIFO0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00342">342</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00473">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  CAN_InitTypeDef CAN_InitStruct;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  NVIC_InitTypeDef NVIC_InitStruct;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  CAN_FilterInitTypeDef CAN_FilterInitStruct;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  CAN_DeInit(CAN1);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  CAN_StructInit(&amp;CAN_InitStruct);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  CAN_InitStruct.CAN_TTCM = DISABLE;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  CAN_InitStruct.CAN_ABOM = DISABLE;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  CAN_InitStruct.CAN_AWUM = DISABLE;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  CAN_InitStruct.CAN_NART = ENABLE;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  CAN_InitStruct.CAN_RFLM = DISABLE;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  CAN_InitStruct.CAN_TXFP = DISABLE;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  CAN_InitStruct.CAN_Mode = CAN_Mode_Normal;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  CAN_InitStruct.CAN_SJW = CAN_SJW_1tq;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  CAN_InitStruct.CAN_BS1 = CAN_BS1_3tq;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  CAN_InitStruct.CAN_BS2 = CAN_BS2_5tq;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  CAN_InitStruct.CAN_Prescaler = 8; <span class="comment">//4: 1M, 8: 500k</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  CAN_Init(CAN1, &amp;CAN_InitStruct);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="comment">// Set the filter to receive everything into FIFO0</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="comment">// but only if A0 is set.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">if</span> (GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_0))</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      CAN_FilterInitStruct.CAN_FilterNumber = 0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      CAN_FilterInitStruct.CAN_FilterMode = CAN_FilterMode_IdMask;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      CAN_FilterInitStruct.CAN_FilterScale = CAN_FilterScale_32bit;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      CAN_FilterInitStruct.CAN_FilterIdHigh = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      CAN_FilterInitStruct.CAN_FilterIdLow = 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      CAN_FilterInitStruct.CAN_FilterMaskIdHigh = 0;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      CAN_FilterInitStruct.CAN_FilterMaskIdLow = 0;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      CAN_FilterInitStruct.CAN_FilterFIFOAssignment = 0;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      CAN_FilterInitStruct.CAN_FilterActivation = ENABLE;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      CAN_FilterInit(&amp;CAN_FilterInitStruct);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="comment">//Setup for FIFO0 data, higher priority than UART</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      NVIC_InitStruct.NVIC_IRQChannel = USB_LP_CAN1_RX0_IRQn;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = 1;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      NVIC_Init(&amp;NVIC_InitStruct);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      CAN_ITConfig(CAN1, CAN_IT_FMP0, ENABLE);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      NVIC_EnableIRQ(USB_LP_CAN1_RX0_IRQn);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c_a6f7efc03bd3aca3d9724efe31e5a1630_icgraph.png" border="0" usemap="#main_8c_a6f7efc03bd3aca3d9724efe31e5a1630_icgraph" alt=""/></div>
<map name="main_8c_a6f7efc03bd3aca3d9724efe31e5a1630_icgraph" id="main_8c_a6f7efc03bd3aca3d9724efe31e5a1630_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="main" alt="" coords="132,5,187,32"/>
</map>
</div>

</div>
</div>
<a id="a049fa4a9b6c1b44b0eef7619b91840d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a049fa4a9b6c1b44b0eef7619b91840d0">&#9670;&nbsp;</a></span>GPIO_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void GPIO_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes the GPIO pins. </p>
<dl class="section note"><dt>Note</dt><dd>JTAG is disabled </dd></dl>
<p>disable JTAG to free up RB3 and RB4 </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00429">429</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00473">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  GPIO_InitTypeDef GPIO_InitStruct;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable, ENABLE);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="comment">// pin A0: UART transmit and CAN receive enable</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="comment">// checked only once during startup.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IPU;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="comment">// Configure CAN pin: A11: RX</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_11;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IPU;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// Configure CAN pin: A12: TX</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_12;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF_OD;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// onboard led</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_13;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_OD;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  GPIO_Init(GPIOC, &amp;GPIO_InitStruct);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// uart pins, alternate function</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  GPIO_StructInit(&amp;GPIO_InitStruct);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF_PP;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_9;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IPU;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_10;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;}</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c_a049fa4a9b6c1b44b0eef7619b91840d0_icgraph.png" border="0" usemap="#main_8c_a049fa4a9b6c1b44b0eef7619b91840d0_icgraph" alt=""/></div>
<map name="main_8c_a049fa4a9b6c1b44b0eef7619b91840d0_icgraph" id="main_8c_a049fa4a9b6c1b44b0eef7619b91840d0_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="main" alt="" coords="136,5,191,32"/>
</map>
</div>

</div>
</div>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Kick the dog </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00473">473</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00342">CAN_init()</a>, <a class="el" href="main_8c_source.html#l00429">GPIO_init()</a>, <a class="el" href="main_8c_source.html#l00111">CANMessageToSend::messageReady</a>, <a class="el" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>, <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00394">UART_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;{</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">messageReady</a> = 0;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">// enable all of the clocks</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC, ENABLE);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  RCC_APB1PeriphClockCmd(RCC_APB1Periph_CAN1, ENABLE);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  RCC_AHBPeriphClockCmd(RCC_AHBPeriph_DMA1, ENABLE);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// initialize the peripherals</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <a class="code" href="main_8c.html#a049fa4a9b6c1b44b0eef7619b91840d0">GPIO_init</a>();</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="main_8c.html#a68189a0494c0d7faf3415e8ce73d573a">UART_init</a>();</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <a class="code" href="main_8c.html#a6f7efc03bd3aca3d9724efe31e5a1630">CAN_init</a>();</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">//Setup the watchdog</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  IWDG_WriteAccessCmd(IWDG_WriteAccess_Enable);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  IWDG_SetPrescaler(IWDG_Prescaler_256);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  IWDG_SetReload(0xFF);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  IWDG_ReloadCounter();</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  IWDG_Enable();</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  trace_puts(<span class="stringliteral">&quot;Interlink node ready!&quot;</span>);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">// check if there is a message to send, if so send it.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">while</span> (1)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">messageReady</a>)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <a class="code" href="main_8c.html#ae087c57bb8f29d173b8b97a9b3c66bfa">sendCANMessage</a>();</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">messageReady</a> = 0;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      IWDG_ReloadCounter();</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div><div class="ttc" id="main_8c_html_a010129fb538a38e59899ecc8241a2bf9"><div class="ttname"><a href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a></div><div class="ttdeci">static struct CANMessageToSend messageToSend</div></div>
<div class="ttc" id="structCANMessageToSend_html_ad8830ca74458bfaafd6a45d203d38d26"><div class="ttname"><a href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">CANMessageToSend::messageReady</a></div><div class="ttdeci">uint8_t messageReady</div><div class="ttdoc">Indicates if a message is ready. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00111">main.c:111</a></div></div>
<div class="ttc" id="main_8c_html_a68189a0494c0d7faf3415e8ce73d573a"><div class="ttname"><a href="main_8c.html#a68189a0494c0d7faf3415e8ce73d573a">UART_init</a></div><div class="ttdeci">static void UART_init(void)</div><div class="ttdoc">Initializes the UART peripheral and recieve interupt. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00394">main.c:394</a></div></div>
<div class="ttc" id="main_8c_html_a6f7efc03bd3aca3d9724efe31e5a1630"><div class="ttname"><a href="main_8c.html#a6f7efc03bd3aca3d9724efe31e5a1630">CAN_init</a></div><div class="ttdeci">static void CAN_init(void)</div><div class="ttdoc">Initializes the CAN peripheral and recieve interupt. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00342">main.c:342</a></div></div>
<div class="ttc" id="main_8c_html_a049fa4a9b6c1b44b0eef7619b91840d0"><div class="ttname"><a href="main_8c.html#a049fa4a9b6c1b44b0eef7619b91840d0">GPIO_init</a></div><div class="ttdeci">static void GPIO_init(void)</div><div class="ttdoc">Initializes the GPIO pins. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00429">main.c:429</a></div></div>
<div class="ttc" id="main_8c_html_ae087c57bb8f29d173b8b97a9b3c66bfa"><div class="ttname"><a href="main_8c.html#ae087c57bb8f29d173b8b97a9b3c66bfa">sendCANMessage</a></div><div class="ttdeci">static void sendCANMessage(void)</div><div class="ttdoc">Sends a CAN message over UART to the PC. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00145">main.c:145</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c_a840291bc02cba5474a4cb46a9b9566fe_cgraph.png" border="0" usemap="#main_8c_a840291bc02cba5474a4cb46a9b9566fe_cgraph" alt=""/></div>
<map name="main_8c_a840291bc02cba5474a4cb46a9b9566fe_cgraph" id="main_8c_a840291bc02cba5474a4cb46a9b9566fe_cgraph">
<area shape="rect" id="node2" href="main_8c.html#a6f7efc03bd3aca3d9724efe31e5a1630" title="Initializes the CAN peripheral and recieve interupt. " alt="" coords="138,5,217,32"/>
<area shape="rect" id="node3" href="main_8c.html#a049fa4a9b6c1b44b0eef7619b91840d0" title="Initializes the GPIO pins. " alt="" coords="136,56,219,83"/>
<area shape="rect" id="node4" href="main_8c.html#ae087c57bb8f29d173b8b97a9b3c66bfa" title="Sends a CAN message over UART to the PC. " alt="" coords="108,107,247,133"/>
<area shape="rect" id="node5" href="main_8c.html#a68189a0494c0d7faf3415e8ce73d573a" title="Initializes the UART peripheral and recieve interupt. " alt="" coords="135,157,220,184"/>
</map>
</div>

</div>
</div>
<a id="ae087c57bb8f29d173b8b97a9b3c66bfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae087c57bb8f29d173b8b97a9b3c66bfa">&#9670;&nbsp;</a></span>sendCANMessage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sendCANMessage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends a CAN message over UART to the PC. </p>
<dl class="section note"><dt>Note</dt><dd>Does all of the transmit UART protocol handling </dd></dl>
<p>To prevent issues with the sync bytes, we must now check there are any bytes with 0xF0, 0xFA, 0xE0, or 0xEF in them.<br />
if so, increment them and store their position.<br />
These positions will be appended to the message so the Receiver will know to decrement them.<br />
The increment indexes themselves will never be large enough to come anywhere close to the start and end bytes, so we can safely append this to the output without them becoming sync bytes.</p>
<p>TODO: Use DMA for transmit </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00145">145</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00096">CHECKLENIDX</a>, <a class="el" href="main_8c_source.html#l00102">DATAIDX</a>, <a class="el" href="main_8c_source.html#l00089">ENDSYNCBYTE1</a>, <a class="el" href="main_8c_source.html#l00092">ENDSYNCBYTE2</a>, <a class="el" href="main_8c_source.html#l00094">LENIDX</a>, <a class="el" href="main_8c_source.html#l00113">CANMessageToSend::message</a>, <a class="el" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>, <a class="el" href="main_8c_source.html#l00085">STARTSYNCBYTE1</a>, <a class="el" href="main_8c_source.html#l00087">STARTSYNCBYTE2</a>, <a class="el" href="main_8c_source.html#l00100">STDIDHIDX</a>, and <a class="el" href="main_8c_source.html#l00098">STDIDLIDX</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00473">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;{</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// Length of the data to send</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  uint8_t len = <a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">message</a>.DLC;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">// holds the index of shifted bytes</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  uint8_t shift[16];</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// amount of bytes that have been shifted</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  uint8_t shiftloc = 0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// current location in the buffer</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  uint8_t i;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// Buffer. Way oversized. Can never be more than 15 large.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  uint8_t buf[80];</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// 0 and 1 indicates start of frame</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  buf[0] = <a class="code" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  buf[1] = <a class="code" href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// 2 is data length</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">// As it will never exceed 8, let alone 0xE0 (224) in size,</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// it will never come close to being a sync byte and we can skip checking this</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  buf[<a class="code" href="main_8c.html#af522364e8a3d83be725532c9550ef632">LENIDX</a>] = len;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// 3 is check length</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">// it also will never exceed 0xE0. Sync will not have to touch this</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  buf[<a class="code" href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a>] = 0;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// 2 and 3 is StdId</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  buf[<a class="code" href="main_8c.html#a2b9b3385907586a36086aca0194dc425">STDIDLIDX</a>] = (uint8_t) (<a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">message</a>.StdId &amp; 0xFF);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  buf[<a class="code" href="main_8c.html#a0b77446b9fff7ef417fd41d94261a7b0">STDIDHIDX</a>] = (uint8_t) ((<a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">message</a>.StdId &amp; 0xFF00) &gt;&gt; 8);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// next comes the data, [6 .. len]</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">for</span> (i = <a class="code" href="main_8c.html#ab5b70d1610bc80caa8de5d76d4036771">DATAIDX</a>; i &lt; len + <a class="code" href="main_8c.html#ab5b70d1610bc80caa8de5d76d4036771">DATAIDX</a>; i++)</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    buf[i] = <a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">message</a>.Data[i - DATAIDX];</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  for (uint8_t check = 4; check &lt; i; check++)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">if</span> ((buf[check - 1] == <a class="code" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a> &amp;&amp; buf[check] == <a class="code" href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a>)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      || (buf[check - 1] == <a class="code" href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a> &amp;&amp; buf[check] == <a class="code" href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a>))</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="comment">//trace_printf(&quot;Injected check for elem %u %#x now %#x\n&quot;, check,</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="comment">//         buf[check], buf[check] + 1);</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      buf[check]++;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      shift[shiftloc++] = check;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      buf[<a class="code" href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a>]++;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">for</span> (uint8_t checkloc = 0; checkloc &lt; shiftloc; checkloc++)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    buf[i++] = shift[checkloc];</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="comment">// and the last two to indicate end</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  buf[i++] = <a class="code" href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  buf[i++] = <a class="code" href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">for</span> (uint8_t j = 0; j &lt; i; j++)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TC) == RESET)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    ;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      USART_SendData(USART1, buf[j]);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="comment">//trace_printf(&quot;buf[%u]: %#x, %u\n&quot;, j, buf[j], buf[j]);</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="ttc" id="main_8c_html_a0b77446b9fff7ef417fd41d94261a7b0"><div class="ttname"><a href="main_8c.html#a0b77446b9fff7ef417fd41d94261a7b0">STDIDHIDX</a></div><div class="ttdeci">#define STDIDHIDX</div><div class="ttdoc">Index of stdid high byte in UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00100">main.c:100</a></div></div>
<div class="ttc" id="main_8c_html_af522364e8a3d83be725532c9550ef632"><div class="ttname"><a href="main_8c.html#af522364e8a3d83be725532c9550ef632">LENIDX</a></div><div class="ttdeci">#define LENIDX</div><div class="ttdoc">Index of length in a UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00094">main.c:94</a></div></div>
<div class="ttc" id="main_8c_html_a2b9b3385907586a36086aca0194dc425"><div class="ttname"><a href="main_8c.html#a2b9b3385907586a36086aca0194dc425">STDIDLIDX</a></div><div class="ttdeci">#define STDIDLIDX</div><div class="ttdoc">Index of stdid low byte in UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00098">main.c:98</a></div></div>
<div class="ttc" id="main_8c_html_adfb421c17a571eaf007319362b5f3150"><div class="ttname"><a href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a></div><div class="ttdeci">#define ENDSYNCBYTE2</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00092">main.c:92</a></div></div>
<div class="ttc" id="main_8c_html_adb8167f4f0890c2ff3178db02172c6dc"><div class="ttname"><a href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a></div><div class="ttdeci">#define STARTSYNCBYTE2</div><div class="ttdoc">Must come right after STARTSYNCBYTE1 to indicate start. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00087">main.c:87</a></div></div>
<div class="ttc" id="main_8c_html_a2d8c7653fe8bc2515492b3d5508043ed"><div class="ttname"><a href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a></div><div class="ttdeci">#define CHECKLENIDX</div><div class="ttdoc">Index of amount of check bytes in UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00096">main.c:96</a></div></div>
<div class="ttc" id="main_8c_html_a95850a46bbeede4b70eb6e556f33a1c9"><div class="ttname"><a href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a></div><div class="ttdeci">#define STARTSYNCBYTE1</div><div class="ttdoc">Indicates start of the UART protocol. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00085">main.c:85</a></div></div>
<div class="ttc" id="main_8c_html_ab5b70d1610bc80caa8de5d76d4036771"><div class="ttname"><a href="main_8c.html#ab5b70d1610bc80caa8de5d76d4036771">DATAIDX</a></div><div class="ttdeci">#define DATAIDX</div><div class="ttdoc">Index of start of the data bytes in uart message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00102">main.c:102</a></div></div>
<div class="ttc" id="main_8c_html_a010129fb538a38e59899ecc8241a2bf9"><div class="ttname"><a href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a></div><div class="ttdeci">static struct CANMessageToSend messageToSend</div></div>
<div class="ttc" id="structCANMessageToSend_html_a8f462138f49a56573b2fbbed2ef30455"><div class="ttname"><a href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">CANMessageToSend::message</a></div><div class="ttdeci">CanRxMsg message</div><div class="ttdoc">The message to be sent to the PC. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00113">main.c:113</a></div></div>
<div class="ttc" id="main_8c_html_ae850c489f0e65c48f92e854b5047a0b4"><div class="ttname"><a href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a></div><div class="ttdeci">#define ENDSYNCBYTE1</div><div class="ttdoc">Indicates end of the UART protocol. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00089">main.c:89</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c_ae087c57bb8f29d173b8b97a9b3c66bfa_icgraph.png" border="0" usemap="#main_8c_ae087c57bb8f29d173b8b97a9b3c66bfa_icgraph" alt=""/></div>
<map name="main_8c_ae087c57bb8f29d173b8b97a9b3c66bfa_icgraph" id="main_8c_ae087c57bb8f29d173b8b97a9b3c66bfa_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="main" alt="" coords="192,5,247,32"/>
</map>
</div>

</div>
</div>
<a id="a68189a0494c0d7faf3415e8ce73d573a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68189a0494c0d7faf3415e8ce73d573a">&#9670;&nbsp;</a></span>UART_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void UART_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes the UART peripheral and recieve interupt. </p>
<dl class="section note"><dt>Note</dt><dd>The baudrate must be set very high (at least 1M) </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00394">394</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00473">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;{</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  USART_InitTypeDef USART_InitStructure;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  NVIC_InitTypeDef NVIC_InitStructure;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">//USART_DeInit(USART1);</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  USART_InitStructure.USART_BaudRate = 2000000;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  USART_InitStructure.USART_WordLength = USART_WordLength_8b;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  USART_InitStructure.USART_StopBits = USART_StopBits_1;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  USART_InitStructure.USART_Parity = USART_Parity_No;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  USART_InitStructure.USART_HardwareFlowControl =</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  USART_HardwareFlowControl_None;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  USART_Init(USART1, &amp;USART_InitStructure);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// Setup the uart interrupt</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 2;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  NVIC_InitStructure.NVIC_IRQChannelSubPriority = 2;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  NVIC_InitStructure.NVIC_IRQChannel = USART1_IRQn;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  NVIC_Init(&amp;NVIC_InitStructure);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// Enable the uart and the uart interrupt</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  USART_Cmd(USART1, ENABLE);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">//Enable recieve interrupt</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  NVIC_EnableIRQ(USART1_IRQn);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">//USART_ClearFlag(USART1, USART_FLAG_TC);</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">//USART_ITConfig(USART1, USART_IT_TXE, ENABLE);</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  USART_ITConfig(USART1, USART_IT_RXNE, ENABLE);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8c_a68189a0494c0d7faf3415e8ce73d573a_icgraph.png" border="0" usemap="#main_8c_a68189a0494c0d7faf3415e8ce73d573a_icgraph" alt=""/></div>
<map name="main_8c_a68189a0494c0d7faf3415e8ce73d573a_icgraph" id="main_8c_a68189a0494c0d7faf3415e8ce73d573a_icgraph">
<area shape="rect" id="node2" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="main" alt="" coords="139,5,193,32"/>
</map>
</div>

</div>
</div>
<a id="a7139cd4baabbbcbab0c1fe6d7d4ae1cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7139cd4baabbbcbab0c1fe6d7d4ae1cc">&#9670;&nbsp;</a></span>USART1_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USART1_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Recieves and stores bytes from PC. When all are present, sends them as a CAN message. </p>
<dl class="section note"><dt>Note</dt><dd>Does all of the recieve UART protocol handling </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00222">222</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00096">CHECKLENIDX</a>, <a class="el" href="main_8c_source.html#l00102">DATAIDX</a>, <a class="el" href="main_8c_source.html#l00089">ENDSYNCBYTE1</a>, <a class="el" href="main_8c_source.html#l00092">ENDSYNCBYTE2</a>, <a class="el" href="main_8c_source.html#l00094">LENIDX</a>, <a class="el" href="main_8c_source.html#l00085">STARTSYNCBYTE1</a>, <a class="el" href="main_8c_source.html#l00087">STARTSYNCBYTE2</a>, <a class="el" href="main_8c_source.html#l00100">STDIDHIDX</a>, and <a class="el" href="main_8c_source.html#l00098">STDIDLIDX</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// recieved byte from UART</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  uint8_t incoming;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">// data length</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  uint8_t len;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">// amount of checkbytes</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  uint8_t checklen;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">// start of checkbytes</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  uint8_t checkbytes_start;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// CAN message to send</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  CanTxMsg TxMessage;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// uart buffer</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">static</span> uint8_t uartbuf[80];</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">// previously recieved byte</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">static</span> uint8_t previous = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">// current position in the buffer</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keyword">static</span> uint8_t bufloc = 0;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">if</span> (USART_GetITStatus(USART1, USART_IT_TXE) != RESET)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      USART_ClearITPendingBit(USART1, USART_IT_TXE);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">if</span> (USART_GetITStatus(USART1, USART_IT_RXNE) != RESET)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      incoming = (char) USART_ReceiveData(USART1);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      USART_ClearITPendingBit(USART1, USART_IT_RXNE);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">// beginning of the message</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">if</span> (incoming == <a class="code" href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a>)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">if</span> (previous == <a class="code" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a>)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;          bufloc = 1;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;          uartbuf[0] = previous;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">// end of the message</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">// beginning of the message</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">if</span> (incoming == <a class="code" href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a>)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">if</span> (previous == <a class="code" href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a>)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          uartbuf[bufloc] = incoming;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          <span class="comment">// message is ready</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          <span class="comment">// first, verify</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          <span class="keywordflow">if</span> (uartbuf[0] != <a class="code" href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a> || uartbuf[1] != <a class="code" href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a>)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          trace_printf(<span class="stringliteral">&quot;not a valid handycan message: invalid header: &quot;</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                   <span class="stringliteral">&quot;%#x %#x\n&quot;</span>,</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                   uartbuf[0], uartbuf[1]);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          <span class="keywordflow">if</span> (uartbuf[bufloc - 1] != <a class="code" href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          || uartbuf[bufloc] != <a class="code" href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a>)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          trace_printf(<span class="stringliteral">&quot;not a valid handycan message: invalid footer: &quot;</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                   <span class="stringliteral">&quot;%#x %#x\n&quot;</span>,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                   uartbuf[bufloc - 1], uartbuf[bufloc]);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          <span class="comment">// get the data length</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          len = uartbuf[<a class="code" href="main_8c.html#af522364e8a3d83be725532c9550ef632">LENIDX</a>];</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          <span class="keywordflow">if</span> ((8 + len + uartbuf[<a class="code" href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a>]) != bufloc + 1)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          trace_printf(<span class="stringliteral">&quot;Message size invalid!\n&quot;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                   <span class="stringliteral">&quot;expected %u got %u\n&quot;</span>,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                   8 + len + uartbuf[CHECKLENIDX], bufloc + 1);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          <span class="comment">// if there are checkbytes, decrement them</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          checklen = uartbuf[<a class="code" href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a>];</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          <span class="keywordflow">if</span> (checklen)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          checkbytes_start = 6 + len;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <span class="comment">// decrement them</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; checklen; i++)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;              uartbuf[uartbuf[checkbytes_start + i]]--;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;          <span class="comment">// now the message has been reconstructed, get the data out of it</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          <span class="comment">// get the StdId</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          TxMessage.StdId = uartbuf[<a class="code" href="main_8c.html#a2b9b3385907586a36086aca0194dc425">STDIDLIDX</a>] | (uartbuf[<a class="code" href="main_8c.html#a0b77446b9fff7ef417fd41d94261a7b0">STDIDHIDX</a>] &lt;&lt; 8);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          TxMessage.ExtId = 0;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          TxMessage.RTR = CAN_RTR_DATA;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          TxMessage.IDE = CAN_ID_STD;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          <span class="comment">// the data length</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          TxMessage.DLC = len;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <span class="comment">// and finally the data</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; len; i++)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          TxMessage.Data[i] = uartbuf[<a class="code" href="main_8c.html#ab5b70d1610bc80caa8de5d76d4036771">DATAIDX</a> + i];</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          <span class="comment">// now transmit this</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          <span class="comment">// note: CAN_Transmit is non-blocking.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          <span class="comment">// it will queue a CAN message in a mailbox.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="comment">// the peripheral will send it as soon as the bus is ready</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;          CAN_Transmit(CAN1, &amp;TxMessage);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="comment">// Store the byte in the buffer, then increment the buffer position</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      uartbuf[bufloc++] = incoming;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="comment">// and store current byte for next time</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      previous = incoming;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div><div class="ttc" id="main_8c_html_a0b77446b9fff7ef417fd41d94261a7b0"><div class="ttname"><a href="main_8c.html#a0b77446b9fff7ef417fd41d94261a7b0">STDIDHIDX</a></div><div class="ttdeci">#define STDIDHIDX</div><div class="ttdoc">Index of stdid high byte in UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00100">main.c:100</a></div></div>
<div class="ttc" id="main_8c_html_af522364e8a3d83be725532c9550ef632"><div class="ttname"><a href="main_8c.html#af522364e8a3d83be725532c9550ef632">LENIDX</a></div><div class="ttdeci">#define LENIDX</div><div class="ttdoc">Index of length in a UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00094">main.c:94</a></div></div>
<div class="ttc" id="main_8c_html_a2b9b3385907586a36086aca0194dc425"><div class="ttname"><a href="main_8c.html#a2b9b3385907586a36086aca0194dc425">STDIDLIDX</a></div><div class="ttdeci">#define STDIDLIDX</div><div class="ttdoc">Index of stdid low byte in UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00098">main.c:98</a></div></div>
<div class="ttc" id="main_8c_html_adfb421c17a571eaf007319362b5f3150"><div class="ttname"><a href="main_8c.html#adfb421c17a571eaf007319362b5f3150">ENDSYNCBYTE2</a></div><div class="ttdeci">#define ENDSYNCBYTE2</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00092">main.c:92</a></div></div>
<div class="ttc" id="main_8c_html_adb8167f4f0890c2ff3178db02172c6dc"><div class="ttname"><a href="main_8c.html#adb8167f4f0890c2ff3178db02172c6dc">STARTSYNCBYTE2</a></div><div class="ttdeci">#define STARTSYNCBYTE2</div><div class="ttdoc">Must come right after STARTSYNCBYTE1 to indicate start. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00087">main.c:87</a></div></div>
<div class="ttc" id="main_8c_html_a2d8c7653fe8bc2515492b3d5508043ed"><div class="ttname"><a href="main_8c.html#a2d8c7653fe8bc2515492b3d5508043ed">CHECKLENIDX</a></div><div class="ttdeci">#define CHECKLENIDX</div><div class="ttdoc">Index of amount of check bytes in UART message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00096">main.c:96</a></div></div>
<div class="ttc" id="main_8c_html_a95850a46bbeede4b70eb6e556f33a1c9"><div class="ttname"><a href="main_8c.html#a95850a46bbeede4b70eb6e556f33a1c9">STARTSYNCBYTE1</a></div><div class="ttdeci">#define STARTSYNCBYTE1</div><div class="ttdoc">Indicates start of the UART protocol. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00085">main.c:85</a></div></div>
<div class="ttc" id="main_8c_html_ab5b70d1610bc80caa8de5d76d4036771"><div class="ttname"><a href="main_8c.html#ab5b70d1610bc80caa8de5d76d4036771">DATAIDX</a></div><div class="ttdeci">#define DATAIDX</div><div class="ttdoc">Index of start of the data bytes in uart message. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00102">main.c:102</a></div></div>
<div class="ttc" id="main_8c_html_ae850c489f0e65c48f92e854b5047a0b4"><div class="ttname"><a href="main_8c.html#ae850c489f0e65c48f92e854b5047a0b4">ENDSYNCBYTE1</a></div><div class="ttdeci">#define ENDSYNCBYTE1</div><div class="ttdoc">Indicates end of the UART protocol. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00089">main.c:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af57bde854fa2b396f29664995a502b19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af57bde854fa2b396f29664995a502b19">&#9670;&nbsp;</a></span>USB_LP_CAN1_RX0_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USB_LP_CAN1_RX0_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when there is a package on the CAN bus. </p>
<dl class="section note"><dt>Note</dt><dd>Places it into message to send, and will be sent by <a class="el" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main()</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00122">122</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00082">GPIO_ToggleBits</a>, <a class="el" href="main_8c_source.html#l00113">CANMessageToSend::message</a>, <a class="el" href="main_8c_source.html#l00111">CANMessageToSend::messageReady</a>, and <a class="el" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  CanRxMsg rx_message;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  CAN_Receive(CAN1, CAN_FIFO0, &amp;rx_message);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">messageReady</a>)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">message</a> = rx_message;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a>.<a class="code" href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">messageReady</a> = 1;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      trace_puts(<span class="stringliteral">&quot;overrun&quot;</span>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">//overruns++;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <a class="code" href="main_8c.html#a5aa8993e015a681ccd0c9bef1b243a49">GPIO_ToggleBits</a>(GPIOC, GPIO_Pin_13);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div><div class="ttc" id="main_8c_html_a010129fb538a38e59899ecc8241a2bf9"><div class="ttname"><a href="main_8c.html#a010129fb538a38e59899ecc8241a2bf9">messageToSend</a></div><div class="ttdeci">static struct CANMessageToSend messageToSend</div></div>
<div class="ttc" id="structCANMessageToSend_html_ad8830ca74458bfaafd6a45d203d38d26"><div class="ttname"><a href="structCANMessageToSend.html#ad8830ca74458bfaafd6a45d203d38d26">CANMessageToSend::messageReady</a></div><div class="ttdeci">uint8_t messageReady</div><div class="ttdoc">Indicates if a message is ready. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00111">main.c:111</a></div></div>
<div class="ttc" id="structCANMessageToSend_html_a8f462138f49a56573b2fbbed2ef30455"><div class="ttname"><a href="structCANMessageToSend.html#a8f462138f49a56573b2fbbed2ef30455">CANMessageToSend::message</a></div><div class="ttdeci">CanRxMsg message</div><div class="ttdoc">The message to be sent to the PC. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00113">main.c:113</a></div></div>
<div class="ttc" id="main_8c_html_a5aa8993e015a681ccd0c9bef1b243a49"><div class="ttname"><a href="main_8c.html#a5aa8993e015a681ccd0c9bef1b243a49">GPIO_ToggleBits</a></div><div class="ttdeci">#define GPIO_ToggleBits(GPIOx, GPIO_Pin)</div><div class="ttdoc">Toggles a IO pin. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00082">main.c:82</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a010129fb538a38e59899ecc8241a2bf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a010129fb538a38e59899ecc8241a2bf9">&#9670;&nbsp;</a></span>messageToSend</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structCANMessageToSend.html">CANMessageToSend</a>  messageToSend</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00473">main()</a>, <a class="el" href="main_8c_source.html#l00145">sendCANMessage()</a>, and <a class="el" href="main_8c_source.html#l00122">USB_LP_CAN1_RX0_IRQHandler()</a>.</p>

</div>
</div>
<a id="a372851451d2a0908f6ab3a497d3593ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a372851451d2a0908f6ab3a497d3593ec">&#9670;&nbsp;</a></span>overruns</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t overruns = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>for debug </p>

<p class="definition">Definition at line <a class="el" href="main_8c_source.html#l00105">105</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
